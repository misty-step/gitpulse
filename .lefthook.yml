# Lefthook Configuration
# Fast git hooks (3-5x faster than Husky, parallel execution)
# Performance budget: <5s pre-commit, <15s pre-push

pre-commit:
  parallel: true
  commands:
    format:
      glob: "*.{ts,tsx,md}"
      run: pnpm prettier --write {staged_files}
      stage_fixed: true
    lint:
      glob: "*.{ts,tsx,js,jsx}"
      run: pnpm eslint --fix --cache {staged_files}
      stage_fixed: true
    secrets:
      run: gitleaks protect --staged --verbose --config .gitleaks.toml

pre-push:
  # Sequential prevents OOM from parallel Next.js build + Jest
  # Convex typecheck removed (too slow, 36+ min; CI catches it instead)
  parallel: false
  commands:
    typecheck:
      run: pnpm typecheck
    test:
      run: pnpm test --bail
    build:
      run: |
        if [ "${SKIP_BUILD_CHECK:-}" = "true" ]; then
          echo "âš ï¸  Skipping build check (SKIP_BUILD_CHECK=true)"
          exit 0
        fi
        echo "ðŸ”¨ Running build check..."
        pnpm build:app
